import{_ as e,a0 as i,a1 as a,a4 as o}from"./framework-16947f8e.js";const c={},n=o(`<h1 id="图片显示空白问题" tabindex="-1"><a class="header-anchor" href="#图片显示空白问题" aria-hidden="true">#</a> 图片显示空白问题</h1><p>前端通过调用后端的接口来下载服务器端的图片，图片是可以正常的下载到手机的内存中去的。</p><p>但是需要通过<code>Cordova</code>调用手机端的原生事件来显示图片，这个时候问题就出现了，图片显示空白。</p><p>原因是因为苹果的限制，不允许app访问本地的图片路径</p><p>可以通过ionic的方法<code>image.src = window.Ionic.WebView.convertFileSrc(result.nativeURL);</code></p><p>将原本本地的图片路径地址(以file://开头)改成以类似请求服务器端的地址(以ionic://开头)，这样就等于没有访问本地图片。</p><p>尽管如此，依旧无法正常显示图片，那是因为angular在编译的时候对路径做了一些安全的限制，防止通过路径链接进行xss攻击</p><p>如果这个url匹配aHrefSanitizationWhitelist的正则表达式规则，则会被添加到DOM中，否则转化后的url将会加上&#39;unsafe://‘前缀后才能被加入到DOM中</p><p>需要通过<code>imgSrcSanitizationWhitelist</code>这个方法来设置编译时清理的白名单，将以<code>ionic</code>开头的路径不转换为<code>unsafe://</code>开头的路径</p><div class="language-AngularJS line-numbers-mode" data-ext="AngularJS"><pre class="language-AngularJS"><code>.config(function($compileProvider) {
    $compileProvider.imgSrcSanitizationWhitelist(/^\\s*(https?|local|data|ionic):/);
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h1 id="跨域cookie丢失" tabindex="-1"><a class="header-anchor" href="#跨域cookie丢失" aria-hidden="true">#</a> 跨域cookie丢失</h1><p>简单的记录一下，防止忘记了</p><p><strong>场景</strong>：使用ios版本13左右的测试机时是正常的，使用ios版本15就出现了问题，cookie不能在请求时自动带上</p><p>正常能自动携带cookie的请求如下：</p><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/7374/正常.png" alt="正常"></p><p>出现问题不能传输cookie请求的如下，发现他在发送请求的时候不会自动携带cookie，但是服务器已经明确的返回了cookie：</p><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/7374/出错.png" alt="出错"></p><p><strong>解决方案：</strong></p><p>解决方案一：简单粗暴的，在每次请求需要cookie的时候都携带用户的信息，不使用token</p><p>解决方案二：在发送ajax请求的时候配置一下：</p><p><code>$httpProvider.defaults.withCredentials = true</code></p><p>之前百度解决方案的时候，我看到大多数都是用这个方案解决的（原生、angular、axios中都有相关的配置项），但是我们的项目中已经事先配置好了，我也不太清楚为什么没有生效。</p><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/7374/IMG_8B5D9731CA0C-1.jpeg" alt="IMG_8B5D9731CA0C-1"></p>`,23),t=[n];function s(p,r){return i(),a("div",null,t)}const l=e(c,[["render",s],["__file","mtydsp.html.vue"]]);export{l as default};
